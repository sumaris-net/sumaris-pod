<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.12.xsd"
                   logicalFilePath="https://github.com/sumaris-net/sumaris-pod/blob/master/sumaris-core/src/main/resources/net/sumaris/core/db/changelog/hsqldb/db-changelog-3.1.2.xml">

  <!-- Add table OPERATION_VESSEL_ASSOCIATION -->
  <changeSet author="jv.famy@codra.fr" id="1739273820923-001" runOnChange="true">
    <preConditions onFail="MARK_RAN">
      <not>
        <tableExists tableName="operation_vessel_association"/>
      </not>
    </preConditions>
    <createTable tableName="operation_vessel_association">
      <column name="operation_fk" type="INT">
        <constraints nullable="false" primaryKey="true" primaryKeyName="operation_vessel_association_pk"/>
      </column>
      <column name="vessel_fk" type="INT">
        <constraints nullable="false" primaryKey="true" primaryKeyName="operation_vessel_association_pk"/>
      </column>
      <column name="is_catch_on_operation_vessel" type="BOOLEAN">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint baseTableName="operation_vessel_association"
                             baseColumnNames="operation_fk"
                             constraintName="ope_vessel_asso_ope_fkc"
                             referencedTableName="operation"
                             referencedColumnNames="id"
                             onDelete="CASCADE"/>
    <addForeignKeyConstraint baseTableName="operation_vessel_association"
                             baseColumnNames="vessel_fk"
                             constraintName="ope_vessel_asso_vessel_fkc"
                             referencedTableName="vessel"
                             referencedColumnNames="id"
                             onDelete="CASCADE"/>
  </changeSet>

  <!-- Update SYSTEM_VERSION -->
  <changeSet author="jv.famy@codra.fr" id="1739273820923-300" runOnChange="true">
    <delete tableName="SYSTEM_VERSION">
      <where>LABEL='3.1.2'</where>
    </delete>
    <insert tableName="SYSTEM_VERSION">
      <column name="ID" valueComputed="NEXT VALUE FOR SYSTEM_VERSION_SEQ"/>
      <column name="LABEL">3.1.2</column>
      <column name="DESCRIPTION">
        - Add OPERATION_VESSEL_ASSOCIATION table
      </column>
      <column name="CREATION_DATE" valueComputed="sysdate"/>
      <column name="UPDATE_DATE" valueComputed="current_timestamp"/>
      <column name="COMMENTS">
        - Add OPERATION_VESSEL_ASSOCIATION table
      </column>
    </insert>
  </changeSet>

</databaseChangeLog>
