<?xml version="1.0" encoding="UTF-8"?>
<queries name="selectObserver">
    <query type="select">
        <select type="number" alias="ID_MAREE">FT.ID</select>
        <select type="number" alias="NAVIRE">FT.VESSEL_FK</select>
        <select type="date" alias="DATE_DEPART">FT.DEPARTURE_DATE_TIME</select>
        <select type="date" alias="DATE_RETOUR">FT.RETURN_DATE_TIME</select>
        <select type="date" alias="DATE_DEBARQ">L.LANDING_DATE_TIME</select>
        <select type="text" alias="PORTDEB_TYP">PORTDEB_TYP</select>
        <select type="text" alias="PORTDEB_COD">LOCDEB.LABEL</select>
        <select type="text" alias="PORTDEB_LIB">LOCDEB.NAME</select>
        <select type="text" alias="QUARTIER_COD">LOCQ.LABEL</select>
        <select type="text" alias="QUARTIER_LIB">LOCQ.NAME</select>
        <select type="text" alias="ATELIER_COD">LOCR.LABEL</select>
        <select type="text" alias="ATELIER_LIB">LOCR.NAME</select>
        <select type="text" alias="OBSERVATEUR_COD">P.EMPLOYEE_NUMBER</select>
        <select type="text" alias="OBSERVATEUR_LIB">P.LASTNAME || ' ' || P.FIRSTNAME</select>
        <select type="text" alias="ENQ_QUALIF_LIB">SELECT QV.NAME
            FROM SURVEY_MEASUREMENT SM, QUALITATIVE_VALUE QV
            WHERE QV.ID = SM.QUALITATIVE_VALUE_FK
            AND SM.FISHING_TRIP_FK = FT.ID
            AND SM.PMFM_FK = 0 --"+context.PMFM_SURVEY_QUALIFICATION+"
        </select>
        <select type="text" alias="ENQ_ORIG_COD">case FT.PROGRAM_FK
            when '"+context.PROGRAM_OBSDEB+"' then 'O'
            when '"+context.PROGRAM_TELDEB+"' then 'T'
            when '"+context.PROGRAM_OPRDEB+"' then 'E'
            else 'Z'
            end
        </select>
        <select type="text" alias="ENQ_ORIG_LIB">case FT.PROGRAM_FK
            when '"+context.PROGRAM_OBSDEB+"' then 'Observation'
            when '"+context.PROGRAM_TELDEB+"' then 'Enquête téléphonique'
            when '"+context.PROGRAM_OPRDEB+"' then 'Enquête de terrain'
            else 'Ancien programme SFA'
            end
        </select>
        <from alias="FT">FISHING_TRIP</from>
        <from join="true">inner join LANDING L on L.FISHING_TRIP_FK = FT.ID
        </from>
        <from join="true">inner join LOCATION LOCDEB on LOCDEB.ID = L.LANDING_LOCATION_FK
        </from>
        <from join="true">inner join LOCATION_HIERARCHY LOCHQ on LOCHQ.CHILD_LOCATION_FK = L.LANDING_LOCATION_FK
        </from>
        <from join="true">inner join LOCATION LOCQ on LOCQ.ID = LOCHQ.PARENT_LOCATION_FK
        </from>
        <from join="true">inner join LOCATION_HIERARCHY LOCHR on LOCHR.CHILD_LOCATION_FK = L.LANDING_LOCATION_FK
        </from>
        <from join="true">inner join LOCATION LOCR on LOCR.ID = LOCHR.PARENT_LOCATION_FK
        </from>
        <from join="true">inner join FISHING_TRIP2OBSERVER_PERSON FTOP on FTOP.FISHING_TRIP_FK = FT.ID
        </from>
        <from join="true">inner join PERSON P on P.ID = FTOP.PERSON_FK
        </from>
        <where>1=1</where>
        <where operator="AND">LOCQ.LOCATION_LEVEL_FK = 32 --"+context.LOCATION_LEVEL_QUARTER+"</where>
        <where operator="AND">LOCR.LOCATION_LEVEL_FK = 31 --"+context.LOCATION_LEVEL_REGION+"</where>
        <where operator="AND">L.PROGRAM_FK in ('SIH-OBSDEB', 'SIH-TELDEB', 'SIH-OPRDEB',
            'ARTFISH','SCHOONER','WHALER')
        </where>
        <where operator="AND">extract(year from L.LANDING_DATE_TIME) in (2018)</where>
    </query>
</queries>